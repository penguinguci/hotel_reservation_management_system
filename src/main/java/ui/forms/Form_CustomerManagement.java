/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/GUIForms/JPanel.java to edit this template
 */

package ui.forms;

import dao.AccountDAOImpl;
import dao.CustomerDAOImpl;
import dao.GenericDAOImpl;
import dao.StaffDAOImpl;
import entities.Account;
import entities.Customer;
import entities.Role;
import entities.Staff;
import interfaces.AccountDAO;
import interfaces.CustomerDAO;
import interfaces.GenericDAO;
import interfaces.StaffDAO;
import jakarta.persistence.EntityTransaction;
import net.coobird.thumbnailator.Thumbnails;
import org.apache.poi.ss.usermodel.Cell;
import ui.components.table.CustomTableButton;
import ultilities.GenerateString;
import ultilities.ImageConverter;
import ultilities.RegexPattern;
import utils.AppUtil;
import utils.DateUtil;
import utils.ExcelUtil;

import javax.imageio.ImageIO;
import javax.swing.*;
import javax.swing.event.ListSelectionEvent;
import javax.swing.event.ListSelectionListener;
import javax.swing.filechooser.FileNameExtensionFilter;
import javax.swing.table.DefaultTableModel;
import java.awt.*;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.image.BufferedImage;
import java.io.File;
import java.io.IOException;
import java.nio.file.Files;
import java.rmi.RemoteException;
import java.util.HashSet;
import java.util.List;
import java.util.Set;

/**
 *
 * @author Lenovo
 */
public class Form_CustomerManagement extends javax.swing.JPanel implements ListSelectionListener{

    /** Creates new form Form_StaffManagement */
    public Form_CustomerManagement() {
        initComponents();
        initTableListener();
        initComboboxGender();
        initComboboxGenderSearch();
        loadStaffData();
    }

    private void initTableListener() {
        table.getTable().getSelectionModel().addListSelectionListener(this);
    }

    private void initComboboxGender() {
        String[] genders = {"Nam", "Nữ"};
        DefaultComboBoxModel<String> model = new DefaultComboBoxModel<>();
        model.addElement("Chọn giới tính");
        for (String gender : genders) {
            model.addElement(gender);
        }
        cbx_Gender.setModel(model);
    }

    private void initComboboxGenderSearch() {
        String[] genders = {"Nam", "Nữ"};
        DefaultComboBoxModel<String> model = new DefaultComboBoxModel<>();
        model.addElement("Chọn giới tính");
        for (String gender : genders) {
            model.addElement(gender);
        }
        cbx_GenderSearch.setModel(model);
    }

    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        pnl_Title = new javax.swing.JPanel();
        jLabel1 = new javax.swing.JLabel();
        pnl_Infor = new javax.swing.JPanel();
        pnl_Input = new javax.swing.JPanel();
        pnl_InforLeft = new javax.swing.JPanel();
        jPanel1 = new javax.swing.JPanel();
        lbl_FirstName = new javax.swing.JLabel();
        lbl_Phone = new javax.swing.JLabel();
        lbl_CCCD = new javax.swing.JLabel();
        lbl_Gender = new javax.swing.JLabel();
        lbl_BirthDate = new javax.swing.JLabel();
        jPanel2 = new javax.swing.JPanel();
        txt_FirstName = new javax.swing.JTextField();
        txt_Phone = new javax.swing.JTextField();
        txt_CCCD = new javax.swing.JTextField();
        cbx_Gender = new ui.components.combobox.StyledComboBox();
        calendar_BirthDate = new ui.components.calendar.CustomCalendar();
        pnl_InforRight = new javax.swing.JPanel();
        jPanel3 = new javax.swing.JPanel();
        lbl_LastName = new javax.swing.JLabel();
        lbl_Email = new javax.swing.JLabel();
        lbl_Point = new javax.swing.JLabel();
        lbl_Address = new javax.swing.JLabel();
        jPanel4 = new javax.swing.JPanel();
        txt_LastName = new javax.swing.JTextField();
        txt_Email = new javax.swing.JTextField();
        txt_Point = new javax.swing.JTextField();
        txt_Address = new javax.swing.JTextField();
        btn_Clear = new ui.components.button.ButtonCancelCustom();
        pnl_Search = new javax.swing.JPanel();
        jPanel5 = new javax.swing.JPanel();
        lbl_StaffIDSearch = new javax.swing.JLabel();
        lbl_NameSearch = new javax.swing.JLabel();
        lbl_PhoneSearch = new javax.swing.JLabel();
        lbl_GenderSearch = new javax.swing.JLabel();
        lbl_CCCD_Search = new javax.swing.JLabel();
        jPanel6 = new javax.swing.JPanel();
        txt_IDSearch = new javax.swing.JTextField();
        txt_NameSearch = new javax.swing.JTextField();
        txt_PhoneSearch = new javax.swing.JTextField();
        cbx_GenderSearch = new ui.components.combobox.StyledComboBox();
        txt_CCCD_Search = new javax.swing.JTextField();
        btn_Search = new ui.components.button.ButtonCustom();
        pnl_ListStaff = new javax.swing.JPanel();
        table = new ui.components.table.CustomTableButton();
        pnl_GroupButton = new javax.swing.JPanel();
        btn_Add = new ui.components.button.ButtonCustom();
        btn_Update = new ui.components.button.ButtonCustom();
        btn_Import = new ui.components.button.ButtonCustom();
        btn_Export = new ui.components.button.ButtonCustom();

        setBackground(new java.awt.Color(255, 255, 255));
        setPreferredSize(new java.awt.Dimension(1200, 1052));

        pnl_Title.setBackground(new java.awt.Color(255, 255, 255));
        pnl_Title.setLayout(new java.awt.BorderLayout());

        jLabel1.setFont(new java.awt.Font("Segoe UI", 1, 18)); // NOI18N
        jLabel1.setForeground(new java.awt.Color(153, 153, 255));
        jLabel1.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        jLabel1.setText("Quản lý khách hàng");
        pnl_Title.add(jLabel1, java.awt.BorderLayout.CENTER);

        pnl_Infor.setBackground(new java.awt.Color(255, 255, 255));
        pnl_Infor.setBorder(javax.swing.BorderFactory.createTitledBorder(null, "Thông tin khách hàng", javax.swing.border.TitledBorder.DEFAULT_JUSTIFICATION, javax.swing.border.TitledBorder.DEFAULT_POSITION, new java.awt.Font("Segoe UI", 1, 16), new java.awt.Color(153, 153, 255))); // NOI18N

        pnl_Input.setBackground(new java.awt.Color(255, 255, 255));

        pnl_InforLeft.setBackground(new java.awt.Color(255, 255, 255));

        jPanel1.setBackground(new java.awt.Color(255, 255, 255));
        jPanel1.setLayout(new java.awt.GridLayout(5, 1));

        lbl_FirstName.setFont(new java.awt.Font("Segoe UI", 0, 15)); // NOI18N
        lbl_FirstName.setText("Họ:");
        jPanel1.add(lbl_FirstName);

        lbl_Phone.setFont(new java.awt.Font("Segoe UI", 0, 15)); // NOI18N
        lbl_Phone.setText("Số điện thoại:");
        jPanel1.add(lbl_Phone);

        lbl_CCCD.setFont(new java.awt.Font("Segoe UI", 0, 15)); // NOI18N
        lbl_CCCD.setText("CCCD:");
        jPanel1.add(lbl_CCCD);

        lbl_Gender.setFont(new java.awt.Font("Segoe UI", 0, 15)); // NOI18N
        lbl_Gender.setText("Giới tính:");
        jPanel1.add(lbl_Gender);

        lbl_BirthDate.setFont(new java.awt.Font("Segoe UI", 0, 15)); // NOI18N
        lbl_BirthDate.setText("Ngày sinh:");
        jPanel1.add(lbl_BirthDate);

        jPanel2.setBackground(new java.awt.Color(255, 255, 255));
        jPanel2.setLayout(new java.awt.GridLayout(5, 1, 0, 12));

        txt_FirstName.setFont(new java.awt.Font("Segoe UI", 0, 15)); // NOI18N
        txt_FirstName.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(204, 204, 204)));
        jPanel2.add(txt_FirstName);

        txt_Phone.setFont(new java.awt.Font("Segoe UI", 0, 15)); // NOI18N
        txt_Phone.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(204, 204, 204)));
        jPanel2.add(txt_Phone);

        txt_CCCD.setFont(new java.awt.Font("Segoe UI", 0, 15)); // NOI18N
        txt_CCCD.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(204, 204, 204)));
        jPanel2.add(txt_CCCD);

        cbx_Gender.setFont(new java.awt.Font("Segoe UI", 0, 15)); // NOI18N
        jPanel2.add(cbx_Gender);
        jPanel2.add(calendar_BirthDate);

        javax.swing.GroupLayout pnl_InforLeftLayout = new javax.swing.GroupLayout(pnl_InforLeft);
        pnl_InforLeft.setLayout(pnl_InforLeftLayout);
        pnl_InforLeftLayout.setHorizontalGroup(
            pnl_InforLeftLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(pnl_InforLeftLayout.createSequentialGroup()
                .addComponent(jPanel1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 27, Short.MAX_VALUE)
                .addComponent(jPanel2, javax.swing.GroupLayout.PREFERRED_SIZE, 242, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap())
        );
        pnl_InforLeftLayout.setVerticalGroup(
            pnl_InforLeftLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jPanel1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
            .addComponent(jPanel2, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );

        pnl_InforRight.setBackground(new java.awt.Color(255, 255, 255));
        pnl_InforRight.setPreferredSize(new java.awt.Dimension(300, 223));

        jPanel3.setBackground(new java.awt.Color(255, 255, 255));
        jPanel3.setLayout(new java.awt.GridLayout(5, 1));

        lbl_LastName.setFont(new java.awt.Font("Segoe UI", 0, 15)); // NOI18N
        lbl_LastName.setText("Tên:");
        jPanel3.add(lbl_LastName);

        lbl_Email.setFont(new java.awt.Font("Segoe UI", 0, 15)); // NOI18N
        lbl_Email.setText("Email:");
        jPanel3.add(lbl_Email);

        lbl_Point.setFont(new java.awt.Font("Segoe UI", 0, 15)); // NOI18N
        lbl_Point.setText("Điểm:");
        jPanel3.add(lbl_Point);

        lbl_Address.setFont(new java.awt.Font("Segoe UI", 0, 15)); // NOI18N
        lbl_Address.setText("Địa chỉ:");
        jPanel3.add(lbl_Address);

        jPanel4.setBackground(new java.awt.Color(255, 255, 255));
        jPanel4.setLayout(new java.awt.GridLayout(5, 1, 0, 12));

        txt_LastName.setFont(new java.awt.Font("Segoe UI", 0, 15)); // NOI18N
        txt_LastName.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(204, 204, 204)));
        txt_LastName.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txt_LastNameActionPerformed(evt);
            }
        });
        jPanel4.add(txt_LastName);

        txt_Email.setFont(new java.awt.Font("Segoe UI", 0, 15)); // NOI18N
        txt_Email.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(204, 204, 204)));
        jPanel4.add(txt_Email);

        txt_Point.setFont(new java.awt.Font("Segoe UI", 0, 15)); // NOI18N
        txt_Point.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(204, 204, 204)));
        txt_Point.setEnabled(false);
        txt_Point.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txt_PointActionPerformed(evt);
            }
        });
        jPanel4.add(txt_Point);

        txt_Address.setFont(new java.awt.Font("Segoe UI", 0, 15)); // NOI18N
        txt_Address.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(204, 204, 204)));
        jPanel4.add(txt_Address);

        javax.swing.GroupLayout pnl_InforRightLayout = new javax.swing.GroupLayout(pnl_InforRight);
        pnl_InforRight.setLayout(pnl_InforRightLayout);
        pnl_InforRightLayout.setHorizontalGroup(
            pnl_InforRightLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 357, Short.MAX_VALUE)
            .addGroup(pnl_InforRightLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                .addGroup(pnl_InforRightLayout.createSequentialGroup()
                    .addGap(28, 28, 28)
                    .addComponent(jPanel3, javax.swing.GroupLayout.PREFERRED_SIZE, 61, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addContainerGap(268, Short.MAX_VALUE)))
            .addGroup(pnl_InforRightLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, pnl_InforRightLayout.createSequentialGroup()
                    .addContainerGap(109, Short.MAX_VALUE)
                    .addComponent(jPanel4, javax.swing.GroupLayout.PREFERRED_SIZE, 242, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addContainerGap()))
        );
        pnl_InforRightLayout.setVerticalGroup(
            pnl_InforRightLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 0, Short.MAX_VALUE)
            .addGroup(pnl_InforRightLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                .addComponent(jPanel3, javax.swing.GroupLayout.DEFAULT_SIZE, 223, Short.MAX_VALUE))
            .addGroup(pnl_InforRightLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                .addComponent(jPanel4, javax.swing.GroupLayout.DEFAULT_SIZE, 223, Short.MAX_VALUE))
        );

        javax.swing.GroupLayout pnl_InputLayout = new javax.swing.GroupLayout(pnl_Input);
        pnl_Input.setLayout(pnl_InputLayout);
        pnl_InputLayout.setHorizontalGroup(
            pnl_InputLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(pnl_InputLayout.createSequentialGroup()
                .addComponent(pnl_InforLeft, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(48, 48, 48)
                .addComponent(pnl_InforRight, javax.swing.GroupLayout.PREFERRED_SIZE, 357, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );
        pnl_InputLayout.setVerticalGroup(
            pnl_InputLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(pnl_InforLeft, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
            .addComponent(pnl_InforRight, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );

        btn_Clear.setText("Xóa trắng");
        btn_Clear.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btn_ClearActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout pnl_InforLayout = new javax.swing.GroupLayout(pnl_Infor);
        pnl_Infor.setLayout(pnl_InforLayout);
        pnl_InforLayout.setHorizontalGroup(
            pnl_InforLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(pnl_InforLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(pnl_InforLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(pnl_InforLayout.createSequentialGroup()
                        .addComponent(btn_Clear, javax.swing.GroupLayout.PREFERRED_SIZE, 119, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(0, 0, Short.MAX_VALUE))
                    .addGroup(pnl_InforLayout.createSequentialGroup()
                        .addComponent(pnl_Input, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addGap(148, 148, 148))))
        );
        pnl_InforLayout.setVerticalGroup(
            pnl_InforLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(pnl_InforLayout.createSequentialGroup()
                .addContainerGap()
                .addComponent(pnl_Input, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(18, 18, 18)
                .addComponent(btn_Clear, javax.swing.GroupLayout.DEFAULT_SIZE, 29, Short.MAX_VALUE))
        );

        pnl_Search.setBackground(new java.awt.Color(255, 255, 255));
        pnl_Search.setBorder(javax.swing.BorderFactory.createTitledBorder(null, "Tìm kiếm khách hàng", javax.swing.border.TitledBorder.DEFAULT_JUSTIFICATION, javax.swing.border.TitledBorder.DEFAULT_POSITION, new java.awt.Font("Segoe UI", 1, 16), new java.awt.Color(153, 153, 255))); // NOI18N
        pnl_Search.setPreferredSize(new java.awt.Dimension(360, 29));

        jPanel5.setBackground(new java.awt.Color(255, 255, 255));
        jPanel5.setLayout(new java.awt.GridLayout(5, 1, 0, 5));

        lbl_StaffIDSearch.setFont(new java.awt.Font("Segoe UI", 0, 15)); // NOI18N
        lbl_StaffIDSearch.setText("Mã khách hàng:");
        jPanel5.add(lbl_StaffIDSearch);

        lbl_NameSearch.setFont(new java.awt.Font("Segoe UI", 0, 15)); // NOI18N
        lbl_NameSearch.setText("Họ và tên:");
        jPanel5.add(lbl_NameSearch);

        lbl_PhoneSearch.setFont(new java.awt.Font("Segoe UI", 0, 15)); // NOI18N
        lbl_PhoneSearch.setText("Số điện thoại:");
        jPanel5.add(lbl_PhoneSearch);

        lbl_GenderSearch.setFont(new java.awt.Font("Segoe UI", 0, 15)); // NOI18N
        lbl_GenderSearch.setText("Giới tính:");
        jPanel5.add(lbl_GenderSearch);

        lbl_CCCD_Search.setFont(new java.awt.Font("Segoe UI", 0, 15)); // NOI18N
        lbl_CCCD_Search.setText("CCCD:");
        jPanel5.add(lbl_CCCD_Search);

        jPanel6.setBackground(new java.awt.Color(255, 255, 255));
        jPanel6.setLayout(new java.awt.GridLayout(5, 1, 0, 10));

        txt_IDSearch.setFont(new java.awt.Font("Segoe UI", 0, 15)); // NOI18N
        txt_IDSearch.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(204, 204, 204)));
        jPanel6.add(txt_IDSearch);

        txt_NameSearch.setFont(new java.awt.Font("Segoe UI", 0, 15)); // NOI18N
        txt_NameSearch.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(204, 204, 204)));
        txt_NameSearch.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txt_NameSearchActionPerformed(evt);
            }
        });
        jPanel6.add(txt_NameSearch);

        txt_PhoneSearch.setFont(new java.awt.Font("Segoe UI", 0, 15)); // NOI18N
        txt_PhoneSearch.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(204, 204, 204)));
        jPanel6.add(txt_PhoneSearch);

        cbx_GenderSearch.setFont(new java.awt.Font("Segoe UI", 0, 15)); // NOI18N
        jPanel6.add(cbx_GenderSearch);

        txt_CCCD_Search.setFont(new java.awt.Font("Segoe UI", 0, 15)); // NOI18N
        txt_CCCD_Search.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(204, 204, 204)));
        jPanel6.add(txt_CCCD_Search);

        btn_Search.setText("Tìm kiếm");
        btn_Search.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btn_SearchActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout pnl_SearchLayout = new javax.swing.GroupLayout(pnl_Search);
        pnl_Search.setLayout(pnl_SearchLayout);
        pnl_SearchLayout.setHorizontalGroup(
            pnl_SearchLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, pnl_SearchLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(pnl_SearchLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addGroup(pnl_SearchLayout.createSequentialGroup()
                        .addGap(0, 0, Short.MAX_VALUE)
                        .addComponent(btn_Search, javax.swing.GroupLayout.PREFERRED_SIZE, 137, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(pnl_SearchLayout.createSequentialGroup()
                        .addComponent(jPanel5, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(jPanel6, javax.swing.GroupLayout.PREFERRED_SIZE, 253, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addGap(12, 12, 12))
        );
        pnl_SearchLayout.setVerticalGroup(
            pnl_SearchLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(pnl_SearchLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(pnl_SearchLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jPanel5, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(jPanel6, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                .addGap(12, 12, 12)
                .addComponent(btn_Search, javax.swing.GroupLayout.PREFERRED_SIZE, 35, javax.swing.GroupLayout.PREFERRED_SIZE))
        );

        pnl_ListStaff.setBackground(new java.awt.Color(255, 255, 255));
        pnl_ListStaff.setLayout(new java.awt.BorderLayout());

        table.setColumnNames(new String[] {"Mã khách hàng", "Tên khách hàng", "Giới tính", "Ngày sinh", "Số điện thoại", "Email", "CCCD", "Địa chỉ", "Điểm"});
        table.setHeaderBackgroundColor(new java.awt.Color(153, 153, 255));
        pnl_ListStaff.add(table, java.awt.BorderLayout.CENTER);

        pnl_GroupButton.setBackground(new java.awt.Color(255, 255, 255));
        pnl_GroupButton.setLayout(new java.awt.GridLayout(4, 1, 0, 20));

        btn_Add.setText("Thêm");
        btn_Add.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btn_AddActionPerformed(evt);
            }
        });
        pnl_GroupButton.add(btn_Add);

        btn_Update.setText("Cập nhật");
        btn_Update.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btn_UpdateActionPerformed(evt);
            }
        });
        pnl_GroupButton.add(btn_Update);

        btn_Import.setText("Import");
        btn_Import.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btn_ImportActionPerformed(evt);
            }
        });
        pnl_GroupButton.add(btn_Import);

        btn_Export.setText("Export");
        btn_Export.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btn_ExportActionPerformed(evt);
            }
        });
        pnl_GroupButton.add(btn_Export);

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);
        this.setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(pnl_Title, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
            .addGroup(layout.createSequentialGroup()
                .addComponent(pnl_Infor, javax.swing.GroupLayout.PREFERRED_SIZE, 803, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(pnl_Search, javax.swing.GroupLayout.DEFAULT_SIZE, 403, Short.MAX_VALUE))
            .addGroup(layout.createSequentialGroup()
                .addComponent(pnl_ListStaff, javax.swing.GroupLayout.PREFERRED_SIZE, 1102, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(pnl_GroupButton, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addContainerGap())
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addComponent(pnl_Title, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(18, 18, 18)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(pnl_Infor, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(pnl_Search, javax.swing.GroupLayout.DEFAULT_SIZE, 305, Short.MAX_VALUE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(pnl_ListStaff, javax.swing.GroupLayout.DEFAULT_SIZE, 692, Short.MAX_VALUE)
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(pnl_GroupButton, javax.swing.GroupLayout.PREFERRED_SIZE, 256, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(0, 0, Short.MAX_VALUE)))
                .addContainerGap())
        );
    }// </editor-fold>//GEN-END:initComponents

    private void txt_LastNameActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txt_LastNameActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_txt_LastNameActionPerformed

    private void txt_PointActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txt_PointActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_txt_PointActionPerformed

    private void txt_NameSearchActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txt_NameSearchActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_txt_NameSearchActionPerformed

    private void btn_AddActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btn_AddActionPerformed
        add();
    }//GEN-LAST:event_btn_AddActionPerformed

    private void btn_UpdateActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btn_UpdateActionPerformed
        update();
    }//GEN-LAST:event_btn_UpdateActionPerformed

    private void btn_ImportActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btn_ImportActionPerformed
        importData();
    }//GEN-LAST:event_btn_ImportActionPerformed

    private void btn_ExportActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btn_ExportActionPerformed
        exportData();
    }//GEN-LAST:event_btn_ExportActionPerformed

    private void btn_SearchActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btn_SearchActionPerformed
        search();
    }//GEN-LAST:event_btn_SearchActionPerformed

    private void btn_ClearActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btn_ClearActionPerformed
        clearForm();
    }//GEN-LAST:event_btn_ClearActionPerformed
    private void btnResetActionPerformed(java.awt.event.ActionEvent evt) {

    }

    // Hàm Validate dữ liệu
    private boolean validateInput() {
        if (txt_FirstName.getText().trim().isEmpty() || txt_LastName.getText().trim().isEmpty()) {
            JOptionPane.showMessageDialog(this, "Họ và tên không được để trống!", "Lỗi", JOptionPane.ERROR_MESSAGE);
            txt_FirstName.requestFocus();
            return false;
        }

        String phone = txt_Phone.getText().trim();
        if (!phone.matches(RegexPattern.PHONE_VN)) {
            JOptionPane.showMessageDialog(this, "Số điện thoại không hợp lệ!", "Lỗi", JOptionPane.ERROR_MESSAGE);
            txt_Phone.requestFocus();
            return false;
        } else if (phone.isEmpty()) {
            JOptionPane.showMessageDialog(this, "Số điện thoại không được để trống!", "Lỗi", JOptionPane.ERROR_MESSAGE);
            txt_Phone.requestFocus();
            return false;
        }

        String email = txt_Email.getText().trim();
        if (!email.isEmpty() && !email.matches(RegexPattern.EMAIL)) {
            JOptionPane.showMessageDialog(this, "Email không hợp lệ!", "Lỗi", JOptionPane.ERROR_MESSAGE);
            txt_Email.requestFocus();
            return false;
        }

        String gender = cbx_Gender.getSelectedItem().toString();
        if (gender.equals("Chọn giới tính")) {
            JOptionPane.showMessageDialog(this, "Vui lòng chọn giới tính", "Lỗi", JOptionPane.ERROR_MESSAGE);
            cbx_Gender.requestFocus();
            return false;
        }


        if (calendar_BirthDate.getSelectedDate() == null) {
            JOptionPane.showMessageDialog(this, "Vui lòng chọn ngày sinh!", "Lỗi", JOptionPane.ERROR_MESSAGE);
            calendar_BirthDate.requestFocus();
            return false;
        }

        if (txt_CCCD.getText().trim().isEmpty()) {
            JOptionPane.showMessageDialog(this, "CCCD không được để trống!", "Lỗi", JOptionPane.ERROR_MESSAGE);
            txt_CCCD.requestFocus();
            return false;
        } else if (!txt_CCCD.getText().matches(RegexPattern.CCCD)) {
            JOptionPane.showMessageDialog(this, "CCCD không hợp lệ!", "Lỗi", JOptionPane.ERROR_MESSAGE);
            txt_CCCD.requestFocus();
            return false;
        }

        return true;
    }

    private void clearForm() {
        txt_FirstName.setText("");
        txt_LastName.setText("");
        txt_Phone.setText("");
        txt_Email.setText("");
        txt_Address.setText("");
        cbx_Gender.setSelectedIndex(0);
        txt_CCCD.setText("");
        txt_CCCD.setEnabled(true);
        txt_Point.setText("");
        calendar_BirthDate.setSelectedDate(null);
        table.getTable().clearSelection();

        txt_NameSearch.setText("");
        txt_PhoneSearch.setText("");
        txt_CCCD_Search.setText("");
        cbx_GenderSearch.setSelectedIndex(0);
        txt_IDSearch.setText("");

        loadStaffData();
    }

    private void loadStaffData() {
        try {
            CustomerDAO customerDAO = new CustomerDAOImpl();
            CustomTableButton.CustomTableModel model = table.getTableModel();
            model.clearData();

            for (Customer customer : customerDAO.findAll()) {
                Object[] rowData = {
                        customer.getCustomerId(),
                        customer.getFirstName() + " " + customer.getLastName(),
                        customer.isGender() ? "Nam" : "Nữ",
                        customer.getDateOfBirth(),
                        customer.getPhoneNumber(),
                        customer.getEmail(),
                        customer.getCCCD(),
                        customer.getAddress(),
                        customer.getBonusPoint()
                };
                model.addRow(rowData, null);
            }
        } catch (Exception e) {
            e.printStackTrace();
            JOptionPane.showMessageDialog(this, "Lỗi khi tải dữ liệu nhân viên", "Lỗi", JOptionPane.ERROR_MESSAGE);
        }
    }



    // Add staff
    private void add() {
        if (!validateInput()) {
            return;
        }

        EntityTransaction transaction = null;
        try {
            CustomerDAO customerDAO = new CustomerDAOImpl();

            String phone = txt_Phone.getText().trim();
            if (customerDAO.isPhoneExists(phone)) {
                JOptionPane.showMessageDialog(this, "Số điện thoại đã tồn tại!", "Lỗi", JOptionPane.ERROR_MESSAGE);
                return;
            }

            String email = txt_Email.getText().trim();
            if (customerDAO.isEmailExists(email)) {
                JOptionPane.showMessageDialog(this, "Email đã tồn tại!", "Lỗi", JOptionPane.ERROR_MESSAGE);
                return;
            }

            Customer newCustomer = new Customer();
            newCustomer.setCustomerId(GenerateString.generateCustomerID());
            newCustomer.setFirstName(txt_FirstName.getText().trim());
            newCustomer.setLastName(txt_LastName.getText().trim());

            String gender = cbx_Gender.getSelectedItem().toString();
            newCustomer.setGender(gender.equals("Nam"));
            newCustomer.setDateOfBirth(calendar_BirthDate.getSelectedDate());
            newCustomer.setPhoneNumber(phone);
            newCustomer.setEmail(email);
            newCustomer.setCCCD(txt_CCCD.getText().trim());
            newCustomer.setAddress(txt_Address.getText().trim());
            newCustomer.setBonusPoint(0);

            // Xử lý transaction
            transaction = AppUtil.getEntityManager().getTransaction();
            transaction.begin();
            if (customerDAO.create(newCustomer)) {
                transaction.commit();
                JOptionPane.showMessageDialog(this, "Thêm khách hàng thành công!", "Thành công", JOptionPane.INFORMATION_MESSAGE);
                clearForm();
            } else {
                transaction.rollback();
                JOptionPane.showMessageDialog(this, "Thêm khách hàng thất bại!", "Lỗi", JOptionPane.ERROR_MESSAGE);
            }
        } catch (Exception e) {
            if (transaction != null && transaction.isActive()) {
                transaction.rollback();
            }
            e.printStackTrace();
            JOptionPane.showMessageDialog(this, "Lỗi khi thêm khách hàng!", "Lỗi", JOptionPane.ERROR_MESSAGE);
        }
    }

    @Override
    public void valueChanged(ListSelectionEvent e) {
        if (!e.getValueIsAdjusting()) {
            int row = table.getTable().getSelectedRow();
            System.out.println(row);
            if (row >= 0) {
                try {
                    fillRow(row);
                } catch (RemoteException ex) {
                    throw new RuntimeException(ex);
                }
            }
        }
    }

    private void fillRow(int row) throws RemoteException {
        CustomTableButton.CustomTableModel model = table.getTableModel();
        Object[] rowData = model.getRowData(row);

        String id = rowData[0].toString();
        CustomerDAO customerDAO = new CustomerDAOImpl();
        Customer customer = customerDAO.findById(id);
        txt_FirstName.setText(customer.getFirstName());
        txt_LastName.setText(customer.getLastName());
        txt_Phone.setText(customer.getPhoneNumber());
        txt_Email.setText(customer.getEmail());
        txt_CCCD.setText(customer.getCCCD());
        txt_CCCD.setEnabled(false);
        txt_Point.setText(String.valueOf(customer.getBonusPoint()));
        txt_Address.setText(customer.getAddress());
        cbx_Gender.setSelectedItem(customer.isGender() == true ? "Nam" : "Nữ");
        calendar_BirthDate.setSelectedDate(customer.getDateOfBirth());
    }


    // Update staff
    private void update() {
        int selectedRow = table.getTable().getSelectedRow();
        if (selectedRow < 0) {
            JOptionPane.showMessageDialog(this, "Vui lòng chọn khách hàng cần cập nhật!",
                    "Thông báo", JOptionPane.WARNING_MESSAGE);
            return;
        }

        if (!validateInput()) {
            return;
        }

        try {
            CustomerDAO customerDAO = new CustomerDAOImpl();

            CustomTableButton.CustomTableModel model = table.getTableModel();
            Object[] rowData = model.getRowData(selectedRow);

            String customerID = rowData[0].toString();
            Customer customer = customerDAO.findById(customerID);

            customer.setFirstName(txt_FirstName.getText() != null ? txt_FirstName.getText().trim() : "");
            customer.setLastName(txt_LastName.getText() != null ? txt_LastName.getText().trim() : "");
            customer.setGender(cbx_Gender.getSelectedIndex() == 1);
            customer.setDateOfBirth(calendar_BirthDate.getSelectedDate());
            customer.setPhoneNumber(txt_Phone.getText() != null ? txt_Phone.getText().trim() : "");
            customer.setAddress(txt_Address.getText() != null ? txt_Address.getText().trim() : "");
            customer.setEmail(txt_Email.getText() != null ? txt_Email.getText().trim() : "");
            customer.setCCCD(txt_CCCD.getText() != null ? txt_CCCD.getText().trim() : "");
            customer.setBonusPoint(Double.parseDouble(txt_Point.getText().trim()));

            boolean customerUpdated = customerDAO.update(customer);

            if (!customerUpdated) {
                JOptionPane.showMessageDialog(this, "Cập nhật thông tin thất bại!", "Lỗi", JOptionPane.ERROR_MESSAGE);
                return;
            } else {
                JOptionPane.showMessageDialog(this, "Cập nhật khách hàng thành công!",
                        "Thành công", JOptionPane.INFORMATION_MESSAGE);
                loadStaffData();
                clearForm();
            }
        } catch (Exception e) {
            e.printStackTrace();
            String errorMessage = e.getMessage() != null ? e.getMessage() : "Lỗi không xác định: " + e.getClass().getName();
            JOptionPane.showMessageDialog(this, "Lỗi khi cập nhật: " + errorMessage,
                    "Lỗi", JOptionPane.ERROR_MESSAGE);
        }
    }

    // Search customer
    private void search() {
        String id = txt_IDSearch.getText().trim();
        String name = txt_NameSearch.getText().trim();
        String phone = txt_PhoneSearch.getText().trim();
        Boolean gender = null;
        String cccd = txt_CCCD_Search.getText().trim();

        if (cbx_GenderSearch.getSelectedIndex() > 0) {
            gender = cbx_GenderSearch.getSelectedIndex() == 1;
        }

        CustomerDAO customerDAO = new CustomerDAOImpl();
        List<Customer> customerList = customerDAO.searchCustomerAdvanced(id, name, phone, gender, cccd);

        CustomTableButton.CustomTableModel model = table.getTableModel();
        model.clearData();

        for (Customer customer : customerList) {
            Object[] rowData = {
                    customer.getCustomerId(),
                    customer.getFirstName() + " " + customer.getLastName(),
                    customer.isGender() ? "Nam" : "Nữ",
                    customer.getDateOfBirth(),
                    customer.getPhoneNumber(),
                    customer.getEmail(),
                    customer.getCCCD(),
                    customer.getAddress(),
                    customer.getBonusPoint()
            };
            model.addRow(rowData, null);
        }
    }

    //    // Export
    private void exportData() {
        ExcelUtil.exportToExcel(
                table,
                "Xuất dữ liệu khách hàng",
                "Danh sách khách hàng",
                this
        );
    }

    // Import
    private void importData() {
        CustomerDAO customerDAO = new CustomerDAOImpl();

        boolean success =  ExcelUtil.importFromExcel(this, row -> {
            EntityTransaction transaction = AppUtil.getEntityManager().getTransaction();
            try {
                Customer customer = new Customer();
                customer.setCustomerId(getCellStringValue(row.getCell(0)));
                customer.setFirstName(getCellStringValue(row.getCell(1)).split(" ")[0]);
                customer.setLastName(getCellStringValue(row.getCell(1)).split(" ")[1]);

                String genderStr = getCellStringValue(row.getCell(2));
                customer.setGender("Nam".equalsIgnoreCase(genderStr));

                String dobStr = getCellStringValue(row.getCell(3));
                customer.setDateOfBirth(DateUtil.parseDateFlexible(dobStr));

                String phoneStr = getCellStringValue(row.getCell(4));
                customer.setPhoneNumber(phoneStr);

                customer.setEmail(getCellStringValue(row.getCell(5)));

                customer.setCCCD(getCellStringValue(row.getCell(6)));

                customer.setAddress(getCellStringValue(row.getCell(7)));

                String pointStr = getCellStringValue(row.getCell(8));
                customer.setBonusPoint(pointStr.isEmpty() ? 0 : Double.parseDouble(pointStr));

                if (customerDAO.isPhoneExists(phoneStr)) {
                    JOptionPane.showMessageDialog(this, "Số điện thoại đã tồn tại: " + phoneStr, "Lỗi", JOptionPane.ERROR_MESSAGE);
                    return false;
                }
                transaction.begin();
                customerDAO.create(customer);
                transaction.commit();
                return true;
            } catch (Exception e) {
                if (transaction.isActive()) {
                    transaction.rollback();
                }
                JOptionPane.showMessageDialog(this, "Lỗi khi nhập dữ liệu: " + e.getMessage(), "Lỗi", JOptionPane.ERROR_MESSAGE);
                return false;
            }
        });

        if (success) {
            loadStaffData();
        }
    }

    // Helper method to get cell value as String
    private String getCellStringValue(Cell cell) {
        if (cell == null) {
            return null;
        }
        switch (cell.getCellType()) {
            case STRING:
                return cell.getStringCellValue();
            case NUMERIC:
                return String.valueOf((int) cell.getNumericCellValue());
            case BOOLEAN:
                return String.valueOf(cell.getBooleanCellValue());
            default:
                return "";
        }
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private ui.components.button.ButtonCustom btn_Add;
    private ui.components.button.ButtonCancelCustom btn_Clear;
    private ui.components.button.ButtonCustom btn_Export;
    private ui.components.button.ButtonCustom btn_Import;
    private ui.components.button.ButtonCustom btn_Search;
    private ui.components.button.ButtonCustom btn_Update;
    private ui.components.calendar.CustomCalendar calendar_BirthDate;
    private ui.components.combobox.StyledComboBox cbx_Gender;
    private ui.components.combobox.StyledComboBox cbx_GenderSearch;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JPanel jPanel3;
    private javax.swing.JPanel jPanel4;
    private javax.swing.JPanel jPanel5;
    private javax.swing.JPanel jPanel6;
    private javax.swing.JLabel lbl_Address;
    private javax.swing.JLabel lbl_BirthDate;
    private javax.swing.JLabel lbl_CCCD;
    private javax.swing.JLabel lbl_CCCD_Search;
    private javax.swing.JLabel lbl_Email;
    private javax.swing.JLabel lbl_FirstName;
    private javax.swing.JLabel lbl_Gender;
    private javax.swing.JLabel lbl_GenderSearch;
    private javax.swing.JLabel lbl_LastName;
    private javax.swing.JLabel lbl_NameSearch;
    private javax.swing.JLabel lbl_Phone;
    private javax.swing.JLabel lbl_PhoneSearch;
    private javax.swing.JLabel lbl_Point;
    private javax.swing.JLabel lbl_StaffIDSearch;
    private javax.swing.JPanel pnl_GroupButton;
    private javax.swing.JPanel pnl_Infor;
    private javax.swing.JPanel pnl_InforLeft;
    private javax.swing.JPanel pnl_InforRight;
    private javax.swing.JPanel pnl_Input;
    private javax.swing.JPanel pnl_ListStaff;
    private javax.swing.JPanel pnl_Search;
    private javax.swing.JPanel pnl_Title;
    private ui.components.table.CustomTableButton table;
    private javax.swing.JTextField txt_Address;
    private javax.swing.JTextField txt_CCCD;
    private javax.swing.JTextField txt_CCCD_Search;
    private javax.swing.JTextField txt_Email;
    private javax.swing.JTextField txt_FirstName;
    private javax.swing.JTextField txt_IDSearch;
    private javax.swing.JTextField txt_LastName;
    private javax.swing.JTextField txt_NameSearch;
    private javax.swing.JTextField txt_Phone;
    private javax.swing.JTextField txt_PhoneSearch;
    private javax.swing.JTextField txt_Point;
    // End of variables declaration//GEN-END:variables

}
